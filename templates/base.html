<!DOCTYPE html>
<html>
<head>
    {% load staticfiles %}
    {% load i18n %}
    {% get_available_languages as languages %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SGA| Dashboard</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta http-equiv='cache-control' content='no-cache, no-store, must-revalidate'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>
    <link rel="stylesheet" href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'theme/css/AdminLTE.min.css' %}">
    <link rel="stylesheet" href="{% static 'theme/css/skins/_all-skins.min.css' %}">
    <link rel="stylesheet" href="{% static 'theme/css/parsley.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/plugins/iCheck/flat/blue.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/plugins/morris/morris.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/plugins/jvectormap/jquery-jvectormap-1.2.2.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/plugins/datepicker/datepicker3.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/plugins/daterangepicker/daterangepicker.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/plugins/select2/select2.min.css' %}">
    <link rel="stylesheet" href="{% static 'custom/dashboard/css/custom.css' %}">
    <link rel="stylesheet" href="{% static 'custom/dashboard/css/price-list.css' %}">
    <link rel="stylesheet" href="{%static 'vendor/plugins/timepicker/bootstrap-timepicker.min.css' %}"> 
    <link rel="stylesheet" href="{%static 'vendor/plugins/owl-carwsel/owl.carousel.min.css' %}"> 
    <link rel="stylesheet" href="{%static 'vendor/plugins/owl-carwsel/owl.theme.default.min.css' %}"> 
    <link rel="stylesheet" href="{%static 'custom/cliente/css/multiple-emails.css' %}"> 
    <link rel="stylesheet" href="{%static 'custom/warehouse/css/warehouse_entrance_detail.css' %}"> 
    <link rel="stylesheet" href="{%static 'custom/warehouse/css/warehouse_exit_detail.css' %}"> 
    {% block title %}
    {% endblock %}
    {% block header-links %}
    {% endblock %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
</head>
<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">
        <header class="main-header">
            <nav class="navbar navbar-static-top">
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">{% trans 'Toggle navigation' %}</span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <li class="dropdown messages-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-envelope-o"></i>
                                <span class="label label-success">0</span>
                            </a>
                        </li>
                        <li class="dropdown notifications-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-bell-o "></i>
                                <span class="label label-warning">0</span>
                            </a>
                            <ul class="dropdown-menu ">
                               <li class="header"><span class="header_text"></span></li>

                               <li>
                                   <ul class="menu">
                                       
                                   </ul>
                               </li>
                       </ul>
                     </li>
                        <li class="dropdown tasks-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-flag-o"></i>
                                <span class="label label-danger">0</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        {% include "sidebar-nav.html" %}

        <div class="content-wrapper">
            <section class="content-header">
                {% block content-header %}
                {% endblock %}
            </section>

            <section class="content">
                {% block content %}
                {% endblock %}
            </section>
        </div>
        <div class="control-sidebar-bg"></div>
    </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="{% static 'vendor/plugins/jQuery/jquery-2.2.3.min.js' %}"></script>
<!-- <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script> -->
<script type="text/javascript" src="{% static 'theme/js/loadingoverlay.min.js' %}"></script>
<script src="{% static 'theme/js/jquery-ui.min.js' %}"></script>

<script src="{% static 'vendor/plugins/timepicker/bootstrap-timepicker.min.js' %}"></script>
<script>
    (function(global) {
         $.LoadingOverlay('show', {text: 'Cargando..'})

        window.onload = function(){ 
             $.LoadingOverlay('hide')
        }
    })(window);
    $.widget.bridge('uibutton', $.ui.button);
</script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.min.js' %}"></script>

<script src="{% static 'vendor/plugins/morris/morris.min.js' %}"></script>
<script src="{% static 'vendor/plugins/sparkline/jquery.sparkline.min.js' %}"></script>
<script src="{% static 'vendor/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>
<script src="{% static 'vendor/plugins/jvectormap/jquery-jvectormap-world-mill-en.js' %}"></script>
<script src="{% static 'vendor/plugins/knob/jquery.knob.js' %}"></script>
<script src="{% static 'vendor/plugins/daterangepicker/daterangepicker.js' %}"></script>
<script src="{% static 'vendor/plugins/datepicker/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'vendor/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js' %}"></script>
<script src="{% static 'vendor/plugins/slimScroll/jquery.slimscroll.min.js' %}"></script>
<script src="{% static 'vendor/plugins/fastclick/fastclick.js' %}"></script>
<script src="{% static 'theme/js/app.min.js' %}"></script>
<script src="{% static 'vendor/plugins/select2/select2.full.min.js' %}"></script>
<script src="{% static 'theme/js/parsley.min.js' %}"></script>
<script src="{% static 'vendor/plugins/owl-carwsel/owl.carousel.min.js' %}"></script>
<script src="{% static 'vendor/plugins/input-mask/jquery.inputmask.js' %}"></script>
<script src="{% static 'vendor/plugins/input-mask/jquery.inputmask.extensions.js' %}"></script>
<script src="{% static 'vendor/plugins/validater/jquery.validate.min.js' %}"></script>
<script src="{% static 'custom/cliente/js/multiple-emails.js' %}"></script>
<script src="{% static 'custom/notifications/user_notifications.js' %}"></script>
<script type="text/javascript">
    {% if messages %}
            {% for message in messages %}
                Swal.fire(
                      'Alert',
                      '{{ message }}',
                      '{{ message.tags }}'
                    )

            {% endfor %}
    {% endif %}
</script>
<script type="text/javascript">
    $('#id_pallete_palet_lot, #pallete_palet_lot_id, .palet_lot, #id_pallete_uniq_code, #id_reallocation_new_location').keyup(function()
    {
        $(this).val($(this).val().toUpperCase());
    });
    $.ajaxSetup({ 
        beforeSend: function(xhr, settings) {
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
            // Only send the token to relative URLs i.e. locally.
            xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            }
        } 
    });
    $(document).on('change','.datepicker',function () {
        var input = $(this).val();
        var pattern = /^\d{4}\-(0[1-9]|1[012])\-(0[1-9]|[12][0-9]|3[01])$/;
        if(pattern.test(input)==false)
        {
            $(this).val("") 
        }
        else if(input.length >10){
            $(this).val("")
        }
    });
    $(document).ready(function(){
        $('tr[data-role="w-product-measurment-row"]:visible').find('.w_product_measurment').select2()
    })

    $('#entrance_hour').timepicker({timeFormat: 'h:mm:ss'});
    $('#exit_hour').timepicker({timeFormat: 'h:mm:ss'});
    $('.readonly').keydown(function(e) {
          if (e.keyCode === 8 || e.keyCode === 46)  // Backspace & del
            e.preventDefault();
        }).on('keypress paste cut', function(e) {
          e.preventDefault();
    });
    var products = [];
    function load_products(){
        jQuery.ajax( {
            url: "{% url 'customer-products' 0 %}".replace('0', $("#id_customer").val()),
            type: "GET",
            dataType: "json",
        } ).done( function( response ) {
            products = response
            $("table tr[data-role='w-product-measurment-row']").each(function(){

                selected = $(this).find("td:first").find('select').find(':selected').val()
                $(this).addClass('product_' + selected)
                current_index = $(this)

                select = $(this).find("td:first").find('select').empty()
                select.append('<option value="" selected="selected">---------</option>')
                products.forEach(function(product) {
                    boxes = current_index.find("td:eq(5)").find('input').val()
                    weight = (parseFloat(product['available_weight']) * parseFloat(boxes))
                    volume = (parseFloat(product['available_volume']) * parseFloat(boxes))

                    if(selected == product['id']){
                        select.append('<option value="'+product['id']+'" data-description="'+product['product_description'] +'"data-weight="'+ product['available_weight'] +'"data-variable_weight="'+ product['variable_weight'] +'"data-volume="'+ product['available_volume'] +'"data-available-weight="'+ weight +' "data-pallet="'+ product['pallet'] +'"data-available-volume="'+ volume +'"product-location="'+product['product_location']+'" selected="selected">' +product['product_code']+'</option>') 
                         
                    }
                    else{
                        select.append('<option value="'+product['id']+'" data-description="'+product['product_description'] +'"data-weight="'+ product['available_weight'] +'"data-variable_weight="'+ product['variable_weight'] +'"data-volume="'+ product['available_volume'] +'" data-available-weight="'+ product['available_weight'] +'"data-available-volume="'+ product['available_volume'] +'" product-location="'+product['product_location']+'" data-pallet= "'+ product['pallet']+'">' +product['product_code']+'</option>')
                    }

                })
                description = select.parent().next().find('input')
                description.val(select.find("option:selected").attr('data-description'))

                select.change(function(){

                    description = $(this).parent().next().find('input')
                    description.val($(this).find("option:selected").attr('data-description'))

                    variable_weight = $(this).find("option:selected").attr('data-variable_weight')
                    if(variable_weight == 'false'){
                        $(this).closest("tr").find(".whm_total_kg").attr("readonly", "true")
                    }
                    else{
                        $(this).closest("tr").find(".whm_total_kg").removeAttr("readonly")

                    }
                })

            })
            try{
                get_product_for_incidencia()
            }
            catch(ere){

            }

            $(".w_product_measurment, .exit_product_measurement").each(function() {
                variable_weight = $(this).find("option:selected").attr('data-variable_weight')

                if(variable_weight == 'false'){
                    $(this).closest("tr").find(".whm_total_kg").attr("readonly", "true")
                }
                else{
                    $(this).closest("tr").find(".whm_total_kg").removeAttr("readonly")
                }
            })

        })
    }
    $("#id_customer").change(function(){
        $("#exit_product_detail").empty()
        load_products()

    })
    function get_product_for_incidencia(){
        $("table tr[data-role='w-incidence-product-row']").each(function(){
            selected = $(this).find("td:first").find('select').find(':selected').val()
            select = $(this).find("td:first").find('select').empty()
            select.append('<option value="" selected="selected">---------</option>')
            products.forEach(function(product) {
                if(selected == product['id']){
                    select.append('<option value="'+product['id']+'" data-description="'+product['product_description']+'" selected="selected">' +product['product_code']+'</option>')  
                }
                else{
                    select.append('<option value="'+product['id']+'" data-description="'+product['product_description']+'">' +product['product_code']+'</option>')
                }

            })
            description = select.parent().next().find('input')
            description.val(select.find("option:selected").attr('data-description'))

            select.change(function(){
                description = $(this).parent().next().find('input')
                description.val($(this).find("option:selected").attr('data-description'))
            })
        })
    }

    function isFloat(evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && charCode != 46 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        return true;
    }

    String.prototype.format = String.prototype.f = function() {
        var s = this,
        i = arguments.length;

        while (i--) {
            s = s.replace(new RegExp('\\{' + i + '\\}', 'gm'), arguments[i]);
        }
        return s;
    };


    function ValidateInteger(evt) {
        var theEvent = evt || window.event;

        // Handle paste
        if (theEvent.type === 'paste') {
            key = event.clipboardData.getData('text/plain');
        }
        else {
        // Handle key press
            var key = theEvent.keyCode || theEvent.which;
            key = String.fromCharCode(key);
        }
        var regex = /[0-9]|\./;
        key = parseInt(key)
        if( !regex.test(key) ) {
            theEvent.returnValue = false;
        if(theEvent.preventDefault) theEvent.preventDefault();
        }
    }

    $("#product_customer").change(function(){        
        bar_code = $(this).find(':selected').data('bar_code')
        if(bar_code == "True"){
            $('#id_barcode_to_use').find(':selected').removeAttr("selected")
            $(".product_barcode_div").removeClass("hide")
            $('#id_barcode_to_use').attr("required", "true")
        }
        else{
            $(".product_barcode_div").addClass("hide")
            $('#id_barcode_to_use').val("")
            $('#id_barcode_to_use').removeAttr("required")
        }
    })

    function calculate_barcode_weight_val(barcode_reader_val, product_bar_code){
  barcodes = ["bc_sasa", "BC_Yoreme", "BC_LaVeinte", "BC_Carnicos",
    "BC_GCM", "BC_Cicaba", "BC_Integra", "BC_Integra2", "BC_Bonacarne", "Codigo Ayvi"]
  total_val = 0
  if (product_bar_code == "bc_sasa"){
      var barcode_weight = barcode_reader_val.slice(25, 31)
      var first_four = barcode_weight.slice(0, 4)
      var last_two = barcode_weight.slice(4, 6)
      var total_val = parseInt(first_four) + "." + last_two
    }
  else if (product_bar_code == "BC_Yoreme"){
    var barcode_weight = barcode_reader_val.slice(5, 12)
    var first_four = barcode_weight.slice(0, 3)
    var last_two = barcode_weight.slice(3, 5)
    var total_val = parseInt(first_four) + "." + last_two
  }
  else if (product_bar_code == "BC_LaVeinte"){
    var barcode_weight = barcode_reader_val.slice(7, 14)
    var first_four = barcode_weight.slice(0, 3)
    var last_two = barcode_weight.slice(3, 6)
    var total_val = parseInt(first_four) + "." + last_two    
  }
  else if (product_bar_code == "BC_Carnicos"){
    var barcode_weight = barcode_reader_val.slice(30, 36)
    var first_four = barcode_weight.slice(0, 2)
    var last_two = barcode_weight.slice(2, 4)
    var total_val = parseInt(first_four) + "." + last_two      
  }
  else if (product_bar_code == "BC_GCM"){
    var barcode_weight = barcode_reader_val.slice(25, 30)
    var first_four = barcode_weight.slice(0, 2)
    var last_two = barcode_weight.slice(2, 4)
    var total_val = parseInt(first_four) + "." + last_two    
  }
  else if (product_bar_code == "BC_Cicaba"){
    var barcode_weight = barcode_reader_val.slice(29, 34)
    var first_four = barcode_weight.slice(0, 2)
    var last_two = barcode_weight.slice(2, 4)
    var total_val = parseInt(first_four) + "." + last_two      
  }
  else if (product_bar_code == "BC_Integra"){
    var barcode_weight = barcode_reader_val.slice(33, 38)
    var first_four = barcode_weight.slice(0, 3)
    var last_two = barcode_weight.slice(3, 5)
    var total_val = parseInt(first_four) + "." + last_two    
  }
  else if (product_bar_code == "BC_Integra2"){
    var barcode_weight = barcode_reader_val.slice(21, 26)
    var first_four = barcode_weight.slice(0, 3)
    var last_two = barcode_weight.slice(3, 5)
    var total_val = parseInt(first_four) + "." + last_two     
  }
  else if (product_bar_code == "BC_Soles"){
    var barcode_weight = barcode_reader_val.slice(1, 6)
    var first_four = barcode_weight.slice(0, 3)
    var last_two = barcode_weight.slice(3, 5)
    var total_val = parseInt(first_four) + "." + last_two     
  }
  else if (product_bar_code == "BC_Bonacarne"){
    var weight_type = parseInt(barcode_reader_val.slice(16, 20))
    var first_four = barcode_reader_val.slice(20, 24)
    var last_two = barcode_reader_val.slice(24, 26)
    if(weight_type==3102){
      var total_val = parseFloat(first_four + "." + last_two)
    }
    else{
      result = parseFloat(first_four + "." + last_two)  
      result = parseFloat(result)/2.2046
      total_val= result.toFixed(2);
    }
  }
  else if (product_bar_code == "Codigo Ayvi"){
    var barcode_weight = barcode_reader_val.slice(8, 14)
    var first_four = barcode_weight.slice(0, 4)
    var last_two = barcode_weight.slice(4, 6)
    var total_val = parseInt(first_four) + "." + last_two     
  }
  return total_val;
}

function checkonlyDecimal(evt, item, lenBeforeDecimal, lenAfterDecimal) {
        var charCode = evt.which;

        var trimmed = $(item).val().replace(/\b^0+/g, "");
        if(checkStartsWith(trimmed, '.') == true){
            trimmed = '0' + trimmed;
        }  

        if(charCode == 8 || charCode == 9){
            return true;
        } 

        if(charCode == 46){
            var dotOccurrences = (trimmed.match(/\./g) || []).length;

            if(dotOccurrences != undefined && dotOccurrences == 1){
                return false;
            }else{
                return true;
            }
        }

        if (charCode > 31 && ((charCode < 48) || (charCode > 57))) {
            return false;
        }
        if ($(item).val() != trimmed){
            $(item).val(trimmed);}  

            if(trimmed.indexOf('.') == -1){
                if(trimmed.length >= parseInt(lenBeforeDecimal)){
                    return false;
                }
            }else{
                var inputArr = trimmed.split(".");
                if(inputArr[0].length > parseInt(lenBeforeDecimal) || inputArr[1].length >= parseInt(lenAfterDecimal)){
                    return false;
                }
            }

            return true;
        }

        function checkafterthreeDecimal(e, current_element) {
            var character = String.fromCharCode(e.keyCode)
            var newValue = current_element.value + character;
            if (isNaN(newValue) || hasDecimalPlace(newValue, 4)) {
                e.preventDefault();
                return false;
            }
        };
        function hasDecimalPlace(value, x) {
            var pointIndex = value.indexOf('.');
            return  pointIndex >= 0 && pointIndex < value.length - x;
        }

    $(document).on('change','.only_int_value, .only_float_value',function () {
        field_value = $(this)
        get_not_to_string(field_value)  
    })

    function get_not_to_string(field_value){
        
        if ($.isNumeric($(field_value).val())){
        }
        else{
            alert("Por favor ingrese el valor numérico correcto")
            $(field_value).val("")
            return false
        }

    }
</script>
{% block scripts %}{% endblock %}
{% block sidebar-menu %}
{% endblock %}
</body>
</html>
